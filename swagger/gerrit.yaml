---
swagger: '2.0'
info:
  title: Gerrit data source
  version: '1.0'
  description: Gerrit data source V2
paths:    # swagger forces me to add at least one path
  /noop:
    get:
      description: no-op
      responses:
        200:
          description: ok
definitions:
  DataSource:
    type: object
    properties:
      Slug:
        type: string
        example: gerrit
      Name:
        type: string
        example: Gerrit
  MetaData:
    type: object
    properties:
      BackendName:
        type: string
        example: insights-datasource-gerrit
      BackendVersion:
        type: string
        example: v0.1.0
      Project:
        type: string
        example: Hyperledger Sawtooth
      Tags:
        type: array
        items:
          type: string
          example: my-tag
  Identity:
    type: object
    properties:
      Id:
        type: string
        example: 1234567890abcdef
        description: PK - up to 50 chars
      Name:
        type: string
        example: Lukasz Gryglicki
      Username:
        type: string
        example: lgryglicki
      Email:
        type: string
        example: xyz@abc.com
      DataSourceId:
        type: string
        example: gerrit
        description: data source type slug (FK)
  CodeChangeRequestActivity:
    type: object
    properties:
      Id:
        type: string
        example: 1234567890abcdef
        description: PK - up to 50 chars
      CodeChangeRequestKey:
        type: string
        example: 1234567890abcdef
        description: FK - up to 50 chars, points to CodeChangeRequest.Id
      CodeChangeRequestId:
        type: string
        example: 1234567890abcdef
        description: points to CodeChangeRequest.CodeChangeRequestId 
      CreatedAt:
        type: string
        format: date-time
        example: '2019-09-02 03:00:33.000000'
      ActivityType:
        type: string
        example: unknown yet (gerrit_review_created, gerrit_review_commit, gerrit_review_comment_added, gerrit_review_approval_added), note that approval can be approving or rejecting, approved when state >= 0
        description: allows reconstructing relations
      Body:
        type: string
        description: PR/comment/review body
        example: My comment body
        x-nullable: true
      URL:
        type: string
        description: PR/comment/review URL
        x-nullable: true
      Key:
        type: string
        description: FIXME may be needed to reconstruct gerrit structures (this is Gerrit comment ID if activity is a comment or CodeChangeRequest.Number when activity is review/patchset or Approval ID when activity is an approval)
        example: "150"
        x-nullable: true
      CommitSHA:
        type: string
        x-nullable: true
        example: 2b20505d9d60202c6779342033d344dba0685d1b
        description: if activity type is a review, then we have a commit SHA
      State:
        type: integer
        x-nullable: true
        example: 1
        description: only present if activity type is a review, >= 0 means approved
      IsApproval:
        type: boolean
        x-nullable: true
        example: true, false, null
        description: only present if activity type is an approval (doesn't mean approved, you need to check state >= 0)
      Identity:
        type: object
        description: activity creator (ProjectDataSourceIdentity)
        $ref: "#/definitions/Identity"
  CodeChangeRequestCommit:
    type: object
    properties:
      SHA:
        type: string
        example: 2b20505d9d60202c6779342033d344dba0685d1b
      Author:
        type: object
        description: committer
        $ref: "#/definitions/Identity"
      Committer:
        type: object
        description: committer
        $ref: "#/definitions/Identity"
  CodeChangeRequest:
    type: object
    properties:
      Id:
        type: string
        example: 1234567890abcdef
        description: PK - up to 50 chars
      CodeChangeRequestId:
        type: string
        example: 1234567890abcdef
        description: Gerrit internal PR ID
      CodeChangeRequestNumber:
        type: integer
        example: 123
        description: FIXME Gerrit internal patchset number
      CreatedAt:
        type: string
        format: date-time
      UpdatedAt:
        type: string
        format: date-time
        example: '2019-09-02 03:00:33.000000'
      ClosedAt:
        type: string
        format: date-time
        x-nullable: true
      IsClosed:
        type: boolean
        example: false
      MergedAt:
        type: string
        format: date-time
        x-nullable: true
      IsMerged:
        type: boolean
        example: false
      State:
        type: string
        example: open, closed, merged
      Title:
        type: string
        example: My PR title
      DataSourceId:
        type: string
        example: gerrit
        description: data source type slug (FK)
      Activities:
        type: array
        items:
          $ref: "#/definitions/CodeChangeRequestActivity"
      Labels:
        type: array
        items:
          type: string
          example: /lgtm
      Commits:
        type: array
        items:
          $ref: "#/definitions/CodeChangeRequestCommit"
  Event:
    type: object
    description: single event in gerrit is a review (which is an activity on CodeChangeRequest)
    properties:
      CodeChangeRequest:
        type: object
        x-nullable: true
        $ref: "#/definitions/CodeChangeRequest"
  Data:
    type: object
    description: this is the final output of insights-datasource-gerrit, data source will output packs up to some fixed size, like 500 events pack at once
    properties:
      DataSource:
        type: object
        $ref: "#/definitions/DataSource"
      MetaData:
        type: object
        $ref: "#/definitions/MetaData"
      Endpoint:
        type: string
        description: Gerrit endpoint for which data is being sent
        example: gerrit.onap.org
      Events:
        type: array
        items:
          $ref: "#/definitions/Event"
